2021-09-17 12:03:57 

import time
import tensorflow as tf

tf.compat.v1.disable_eager_execution()
tf.compat.v1.disable_v2_behavior()

bitsW = 1  # bit width of weights
bitsA = 2  # bit width of activations
bitsG = 8  # bit width of gradients
bitsE = 8 # bit width of errors

bitsR = 16  # bit width of randomizer

lr_schedule = [0,1]

Epoch = 100

batchSize = 128

dataSet = 'MNIST'  # 'MNIST','SVHN','CIFAR10', 'ILSVRC2012'

def upper(str):
    return str.upper()

Time = time.strftime('%Y-%m-%d', time.localtime())
Notes = f'{dataSet} {bitsW}{bitsA}{upper(hex(bitsG)[2:])}{upper(hex(bitsE)[2:])} {bitsR} {lr_schedule} {Epoch} {batchSize}'
# Notes = 'lenet5 2888'
# Notes = 'alexnet 28CC'

GPU = [0]
validNum = 0


loadModel = None
# loadModel = '../model/' + '2017-10-26' + '(' + 'vgg7 2888' + ')' + '.tf'
# saveModel = None
saveModel = '../model/' + Time + '(' + Notes + ')' + '.tf'


use_batch_norm = False
lr = tf.compat.v1.Variable(initial_value=0., trainable=False, name='lr', dtype=tf.float32)
# lr_schedule = [0, 8, 200, 1,250,1./8,300,0]
# lr_schedule = [0, 32, 40, 32./8, 60, 32./64, 80, 0]
L2 = 0

lossFunc = 'SSE'
# lossFunc = tf.losses.softmax_cross_entropy
optimizer = tf.compat.v1.train.GradientDescentOptimizer(1)  # lr is controlled in Quantize.G

# shared variables, defined by other files
seed = None
sess = None
W_scale = []

def upper(str):
    return str.upper()

W: /device:GPU:0 Conv/conv0/ [5, 5, 1, 32] Scale:4
W: /device:GPU:0 Conv/conv1/ [5, 5, 32, 64] Scale:32
W: /device:GPU:0 Fc/fc0/ [1024, 512] Scale:32
W: /device:GPU:0 Fc/fc1/ [512, 10] Scale:16
CONV: 52000 FC: 529408 Total: 581408
W: /device:GPU:0 Conv_1/conv0/ [5, 5, 1, 32] Scale:4
W: /device:GPU:0 Conv_1/conv1/ [5, 5, 32, 64] Scale:32
W: /device:GPU:0 Fc_1/fc0/ [1024, 512] Scale:32
W: /device:GPU:0 Fc_1/fc1/ [512, 10] Scale:16

Optimization Start!

lr: 0.000000 -> 1.000000
Epoch: 000  Loss: 93.134081 Train: 0.6207 Test: 0.4087 FPS: 7442 
Epoch: 001  Loss: 61.964209 Train: 0.2306 Test: 0.1433 FPS: 11376 S BEST 
Epoch: 002  Loss: 52.371261 Train: 0.1266 Test: 0.0928 FPS: 10919 S BEST 
Epoch: 003  Loss: 48.977030 Train: 0.1004 Test: 0.0908 FPS: 10966 S BEST 
Epoch: 004  Loss: 46.163729 Train: 0.0883 Test: 0.0678 FPS: 11026 S BEST 
Epoch: 005  Loss: 43.038729 Train: 0.0768 Test: 0.0619 FPS: 10907 S BEST 
Epoch: 006  Loss: 40.110844 Train: 0.0654 Test: 0.0641 FPS: 10898 
Epoch: 007  Loss: 37.460737 Train: 0.0573 Test: 0.0486 FPS: 11224 S BEST 
Epoch: 008  Loss: 36.024038 Train: 0.0515 Test: 0.0435 FPS: 10894 S BEST 
Epoch: 009  Loss: 33.881677 Train: 0.0457 Test: 0.0391 FPS: 10952 S BEST 
Epoch: 010  Loss: 32.310897 Train: 0.0411 Test: 0.0312 FPS: 10981 S BEST 
Epoch: 011  Loss: 30.517628 Train: 0.0371 Test: 0.0311 FPS: 10934 S BEST 
Epoch: 012  Loss: 29.057959 Train: 0.0324 Test: 0.0307 FPS: 10741 S BEST 
Epoch: 013  Loss: 28.031784 Train: 0.0301 Test: 0.0257 FPS: 10823 S BEST 
Epoch: 014  Loss: 27.012553 Train: 0.0284 Test: 0.0242 FPS: 10665 S BEST 
Epoch: 015  Loss: 25.926282 Train: 0.0251 Test: 0.0226 FPS: 10623 S BEST 
Epoch: 016  Loss: 25.550748 Train: 0.0234 Test: 0.0231 FPS: 9890 
Epoch: 017  Loss: 24.817575 Train: 0.0220 Test: 0.0182 FPS: 10864 S BEST 
Epoch: 018  Loss: 24.029647 Train: 0.0207 Test: 0.0188 FPS: 10900 
Epoch: 019  Loss: 23.761752 Train: 0.0191 Test: 0.0177 FPS: 11192 S BEST 
Epoch: 020  Loss: 23.205929 Train: 0.0178 Test: 0.0163 FPS: 11111 S BEST 
Epoch: 021  Loss: 22.767895 Train: 0.0181 Test: 0.0152 FPS: 10352 S BEST 
Epoch: 022  Loss: 22.442041 Train: 0.0177 Test: 0.0147 FPS: 10586 S BEST 
Epoch: 023  Loss: 22.242254 Train: 0.0171 Test: 0.0145 FPS: 10726 S BEST 
Epoch: 024  Loss: 21.843483 Train: 0.0158 Test: 0.0167 FPS: 10757 
Epoch: 025  Loss: 21.635150 Train: 0.0152 Test: 0.0115 FPS: 11074 S BEST 
Epoch: 026  Loss: 21.215812 Train: 0.0141 Test: 0.0132 FPS: 10909 
Epoch: 027  Loss: 20.803419 Train: 0.0136 Test: 0.0125 FPS: 10990 
Epoch: 028  Loss: 20.694712 Train: 0.0140 Test: 0.0141 FPS: 10623 
Epoch: 029  Loss: 20.576122 Train: 0.0131 Test: 0.0113 FPS: 10903 S BEST 
Epoch: 030  Loss: 20.500801 Train: 0.0126 Test: 0.0150 FPS: 10342 
Epoch: 031  Loss: 20.333600 Train: 0.0131 Test: 0.0106 FPS: 10824 S BEST 
Epoch: 032  Loss: 20.213408 Train: 0.0119 Test: 0.0111 FPS: 10526 
Epoch: 033  Loss: 19.970887 Train: 0.0117 Test: 0.0104 FPS: 10891 S BEST 
Epoch: 034  Loss: 19.813301 Train: 0.0113 Test: 0.0104 FPS: 10871 
Epoch: 035  Loss: 19.761485 Train: 0.0114 Test: 0.0100 FPS: 11055 S BEST 
Epoch: 036  Loss: 19.525641 Train: 0.0102 Test: 0.0105 FPS: 10766 
Epoch: 037  Loss: 19.422543 Train: 0.0104 Test: 0.0095 FPS: 10688 S BEST 
Epoch: 038  Loss: 19.407051 Train: 0.0101 Test: 0.0110 FPS: 10687 
Epoch: 039  Loss: 19.398237 Train: 0.0100 Test: 0.0099 FPS: 10810 
Epoch: 040  Loss: 19.311699 Train: 0.0099 Test: 0.0108 FPS: 10870 
Epoch: 041  Loss: 19.275107 Train: 0.0103 Test: 0.0081 FPS: 11074 S BEST 
Epoch: 042  Loss: 19.098825 Train: 0.0096 Test: 0.0087 FPS: 10621 
Epoch: 043  Loss: 19.032051 Train: 0.0090 Test: 0.0089 FPS: 11069 
Epoch: 044  Loss: 18.889156 Train: 0.0088 Test: 0.0086 FPS: 10385 
Epoch: 045  Loss: 18.932158 Train: 0.0093 Test: 0.0086 FPS: 11012 
Epoch: 046  Loss: 18.757479 Train: 0.0085 Test: 0.0094 FPS: 10542 
Epoch: 047  Loss: 18.596688 Train: 0.0077 Test: 0.0082 FPS: 10678 
Epoch: 048  Loss: 18.618056 Train: 0.0082 Test: 0.0073 FPS: 10842 S BEST 
Epoch: 049  Loss: 18.576923 Train: 0.0078 Test: 0.0087 FPS: 10672 
Epoch: 050  Loss: 18.528045 Train: 0.0079 Test: 0.0090 FPS: 11061 
Epoch: 051  Loss: 18.499733 Train: 0.0082 Test: 0.0088 FPS: 10582 
Epoch: 052  Loss: 18.335203 Train: 0.0070 Test: 0.0085 FPS: 11038 
Epoch: 053  Loss: 18.404647 Train: 0.0074 Test: 0.0065 FPS: 10940 S BEST 
Epoch: 054  Loss: 18.380609 Train: 0.0078 Test: 0.0075 FPS: 10692 
Epoch: 055  Loss: 18.320246 Train: 0.0074 Test: 0.0075 FPS: 10999 
Epoch: 056  Loss: 18.276976 Train: 0.0069 Test: 0.0078 FPS: 11010 
Epoch: 057  Loss: 18.240118 Train: 0.0072 Test: 0.0067 FPS: 10875 
Epoch: 058  Loss: 18.190438 Train: 0.0072 Test: 0.0063 FPS: 10704 S BEST 
Epoch: 059  Loss: 18.197650 Train: 0.0072 Test: 0.0078 FPS: 10525 
Epoch: 060  Loss: 18.163462 Train: 0.0070 Test: 0.0071 FPS: 10848 
Epoch: 061  Loss: 18.061966 Train: 0.0061 Test: 0.0073 FPS: 10639 
Epoch: 062  Loss: 18.029915 Train: 0.0067 Test: 0.0086 FPS: 10645 
Epoch: 063  Loss: 17.986378 Train: 0.0066 Test: 0.0074 FPS: 10098 
Epoch: 064  Loss: 17.994658 Train: 0.0062 Test: 0.0066 FPS: 10753 
Epoch: 065  Loss: 17.956197 Train: 0.0063 Test: 0.0076 FPS: 11149 
Epoch: 066  Loss: 17.928953 Train: 0.0065 Test: 0.0069 FPS: 11008 
Epoch: 067  Loss: 17.925748 Train: 0.0060 Test: 0.0064 FPS: 11090 
Epoch: 068  Loss: 17.963942 Train: 0.0059 Test: 0.0068 FPS: 11196 
Epoch: 069  Loss: 17.920940 Train: 0.0057 Test: 0.0074 FPS: 11127 
Epoch: 070  Loss: 17.900908 Train: 0.0062 Test: 0.0071 FPS: 10518 
Epoch: 071  Loss: 17.876870 Train: 0.0060 Test: 0.0066 FPS: 10703 
Epoch: 072  Loss: 17.870726 Train: 0.0057 Test: 0.0063 FPS: 10084 
Epoch: 073  Loss: 17.786592 Train: 0.0062 Test: 0.0066 FPS: 10654 
Epoch: 074  Loss: 17.727564 Train: 0.0053 Test: 0.0062 FPS: 10871 S BEST 
Epoch: 075  Loss: 17.797543 Train: 0.0055 Test: 0.0059 FPS: 10715 S BEST 
Epoch: 076  Loss: 17.759081 Train: 0.0054 Test: 0.0056 FPS: 10965 S BEST 
Epoch: 077  Loss: 17.729167 Train: 0.0056 Test: 0.0062 FPS: 11032 
Epoch: 078  Loss: 17.729434 Train: 0.0053 Test: 0.0064 FPS: 11074 
Epoch: 079  Loss: 17.690171 Train: 0.0051 Test: 0.0052 FPS: 10757 S BEST 
Epoch: 080  Loss: 17.680021 Train: 0.0050 Test: 0.0060 FPS: 10932 
Epoch: 081  Loss: 17.707532 Train: 0.0047 Test: 0.0065 FPS: 10951 
Epoch: 082  Loss: 17.645833 Train: 0.0048 Test: 0.0064 FPS: 11050 
Epoch: 083  Loss: 17.589476 Train: 0.0047 Test: 0.0058 FPS: 10931 
Epoch: 084  Loss: 17.555021 Train: 0.0048 Test: 0.0061 FPS: 10964 
Epoch: 085  Loss: 17.605235 Train: 0.0049 Test: 0.0070 FPS: 11014 
Epoch: 086  Loss: 17.563568 Train: 0.0050 Test: 0.0071 FPS: 10726 
Epoch: 087  Loss: 17.584669 Train: 0.0049 Test: 0.0069 FPS: 10921 
Epoch: 088  Loss: 17.563301 Train: 0.0044 Test: 0.0074 FPS: 11091 
Epoch: 089  Loss: 17.558761 Train: 0.0042 Test: 0.0084 FPS: 10258 
Epoch: 090  Loss: 17.573451 Train: 0.0049 Test: 0.0059 FPS: 11000 
Epoch: 091  Loss: 17.579861 Train: 0.0050 Test: 0.0056 FPS: 10971 
Epoch: 092  Loss: 17.595353 Train: 0.0051 Test: 0.0067 FPS: 11003 
Epoch: 093  Loss: 17.582799 Train: 0.0048 Test: 0.0071 FPS: 10699 
Epoch: 094  Loss: 17.572650 Train: 0.0050 Test: 0.0075 FPS: 10552 
Epoch: 095  Loss: 17.561699 Train: 0.0048 Test: 0.0060 FPS: 10966 
Epoch: 096  Loss: 17.457532 Train: 0.0041 Test: 0.0052 FPS: 11120 
Epoch: 097  Loss: 17.507479 Train: 0.0045 Test: 0.0059 FPS: 11200 
Epoch: 098  Loss: 17.448718 Train: 0.0039 Test: 0.0051 FPS: 10770 S BEST 
Epoch: 099  Loss: 17.480769 Train: 0.0043 Test: 0.0067 FPS: 10771 
