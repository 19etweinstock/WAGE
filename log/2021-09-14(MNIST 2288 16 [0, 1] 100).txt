2021-09-14 22:54:16 

import time
import tensorflow as tf

tf.compat.v1.disable_eager_execution()
tf.compat.v1.disable_v2_behavior()

bitsW = 2  # bit width of weights
bitsA = 2  # bit width of activations
bitsG = 8  # bit width of gradients
bitsE = 8 # bit width of errors

Epoch = 100

lr_schedule = [0,1]

bitsR = 16  # bit width of randomizer

dataSet = 'MNIST'  # 'MNIST','SVHN','CIFAR10', 'ILSVRC2012'

def upper(str):
    return str.upper()

Time = time.strftime('%Y-%m-%d', time.localtime())
Notes = f'{dataSet} {bitsW}{bitsA}{upper(hex(bitsG)[2:])}{upper(hex(bitsE)[2:])} {bitsR} {lr_schedule} {Epoch}'
# Notes = 'lenet5 2888'
# Notes = 'alexnet 28CC'

GPU = [0]
batchSize = 128
validNum = 0


loadModel = None
# loadModel = '../model/' + '2017-10-26' + '(' + 'vgg7 2888' + ')' + '.tf'
# saveModel = None
saveModel = '../model/' + Time + '(' + Notes + ')' + '.tf'


use_batch_norm = False
lr = tf.compat.v1.Variable(initial_value=0., trainable=False, name='lr', dtype=tf.float32)
# lr_schedule = [0, 8, 200, 1,250,1./8,300,0]
# lr_schedule = [0, 32, 40, 32./8, 60, 32./64, 80, 0]
L2 = 0

lossFunc = 'SSE'
# lossFunc = tf.losses.softmax_cross_entropy
optimizer = tf.compat.v1.train.GradientDescentOptimizer(1)  # lr is controlled in Quantize.G

# shared variables, defined by other files
seed = None
sess = None
W_scale = []

def upper(str):
    return str.upper()

W: /device:GPU:0 Conv/conv0/ [5, 5, 1, 32] Scale:2
W: /device:GPU:0 Conv/conv1/ [5, 5, 32, 64] Scale:16
W: /device:GPU:0 Fc/fc0/ [1024, 512] Scale:16
W: /device:GPU:0 Fc/fc1/ [512, 10] Scale:8
CONV: 52000 FC: 529408 Total: 581408
W: /device:GPU:0 Conv_1/conv0/ [5, 5, 1, 32] Scale:2
W: /device:GPU:0 Conv_1/conv1/ [5, 5, 32, 64] Scale:16
W: /device:GPU:0 Fc_1/fc0/ [1024, 512] Scale:16
W: /device:GPU:0 Fc_1/fc1/ [512, 10] Scale:8

Optimization Start!

lr: 0.000000 -> 1.000000
Epoch: 000  Loss: 51.190171 Train: 0.2241 Test: 0.0618 FPS: 2333 
Epoch: 001  Loss: 30.848291 Train: 0.0472 Test: 0.0342 FPS: 3863 S BEST 
Epoch: 002  Loss: 25.454861 Train: 0.0294 Test: 0.0243 FPS: 3520 S BEST 
Epoch: 003  Loss: 22.898771 Train: 0.0206 Test: 0.0163 FPS: 3491 S BEST 
Epoch: 004  Loss: 21.351496 Train: 0.0169 Test: 0.0115 FPS: 3972 S BEST 
Epoch: 005  Loss: 20.331998 Train: 0.0135 Test: 0.0102 FPS: 4030 S BEST 
Epoch: 006  Loss: 19.517895 Train: 0.0116 Test: 0.0090 FPS: 4118 S BEST 
Epoch: 007  Loss: 19.052618 Train: 0.0104 Test: 0.0075 FPS: 4173 S BEST 
Epoch: 008  Loss: 18.658387 Train: 0.0092 Test: 0.0089 FPS: 4175 
Epoch: 009  Loss: 18.318109 Train: 0.0077 Test: 0.0068 FPS: 4398 S BEST 
Epoch: 010  Loss: 18.099893 Train: 0.0075 Test: 0.0083 FPS: 4142 
Epoch: 011  Loss: 17.896902 Train: 0.0069 Test: 0.0073 FPS: 4322 
Epoch: 012  Loss: 17.788996 Train: 0.0066 Test: 0.0079 FPS: 4368 
Epoch: 013  Loss: 17.728900 Train: 0.0060 Test: 0.0067 FPS: 4314 S BEST 
Epoch: 014  Loss: 17.595085 Train: 0.0056 Test: 0.0064 FPS: 4167 S BEST 
Epoch: 015  Loss: 17.461806 Train: 0.0048 Test: 0.0070 FPS: 4220 
Epoch: 016  Loss: 17.435363 Train: 0.0051 Test: 0.0064 FPS: 4302 
Epoch: 017  Loss: 17.328793 Train: 0.0049 Test: 0.0058 FPS: 4411 S BEST 
Epoch: 018  Loss: 17.266560 Train: 0.0045 Test: 0.0063 FPS: 4186 
Epoch: 019  Loss: 17.141293 Train: 0.0037 Test: 0.0057 FPS: 4274 S BEST 
Epoch: 020  Loss: nan Train: 0.7020 Test: 1.0000 FPS: 4112 
Epoch: 021  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 4338 
Epoch: 022  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 4284 
Epoch: 023  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 4222 
Epoch: 024  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 3893 
Epoch: 025  