2017-10-22 22:57:35 

import time
import tensorflow as tf

Time = time.strftime('%Y-%m-%d', time.localtime())
Notes = 'vgg7 2888'

GPU = [0]
batchSize = 128
validNum = 0

dataSet = 'CIFAR10'  # 'MNIST','SVHN','CIFAR10', 'ILSVRC2012'

loadModel = None
# loadModel = '../model/' + '2017-10-27' + '(' + 'vgg7 2888' + ')' + '.tf'
saveModel = None
saveModel = '../model/' + Time + '(' + Notes + ')' + '.tf'

bitsW = 2  # bit width of weights
bitsA = 8  # bit width of activations
bitsG = 8  # bit width of gradients
bitsE = 8  # bit width of errors

bitsR = 16  # bit width of randomizer

use_batch_norm = False
lr = tf.Variable(initial_value=0., trainable=False, name='lr', dtype=tf.float32)
lr_schedule = [0, 8, 200, 1,250,1./8,300,0]
L2 = 0

lossFunc = 'SSE'
optimizer = tf.train.GradientDescentOptimizer(1)  # lr is controlled in Quantize.G

# shared variables, defined by other files
seed = None
sess = None
W_scale = []

W: /device:GPU:0 U0/C0/conv/ [3, 3, 3, 128] Scale:2
W: /device:GPU:0 U0/C1/conv/ [3, 3, 128, 128] Scale:16
W: /device:GPU:0 U1/C0/conv/ [3, 3, 128, 256] Scale:16
W: /device:GPU:0 U1/C1/conv/ [3, 3, 256, 256] Scale:16
W: /device:GPU:0 U2/C0/conv/ [3, 3, 256, 512] Scale:16
W: /device:GPU:0 U2/C1/conv/ [3, 3, 512, 512] Scale:32
W: /device:GPU:0 FC/fc0/ [8192, 1024] Scale:32
W: /device:GPU:0 FC/fc1/ [1024, 10] Scale:16
CONV: 4574592 FC: 8398848 Total: 12973440
W: /device:GPU:0 U0_1/C0/conv/ [3, 3, 3, 128] Scale:2
W: /device:GPU:0 U0_1/C1/conv/ [3, 3, 128, 128] Scale:16
W: /device:GPU:0 U1_1/C0/conv/ [3, 3, 128, 256] Scale:16
W: /device:GPU:0 U1_1/C1/conv/ [3, 3, 256, 256] Scale:16
W: /device:GPU:0 U2_1/C0/conv/ [3, 3, 256, 512] Scale:16
W: /device:GPU:0 U2_1/C1/conv/ [3, 3, 512, 512] Scale:32
W: /device:GPU:0 FC_1/fc0/ [8192, 1024] Scale:32
W: /device:GPU:0 FC_1/fc1/ [1024, 10] Scale:16

Optimization Start!

lr: 0.000000 -> 8.000000
Epoch: 000  Loss: 52.684054 Train: 0.7015 Test: 0.6396 FPS: 1936 
Epoch: 001  Loss: 47.104353 Train: 0.5827 Test: 0.5127 FPS: 2250 S BEST 
Epoch: 002  Loss: 42.286240 Train: 0.5015 Test: 0.4700 FPS: 2244 S BEST 
Epoch: 003  Loss: 37.751712 Train: 0.4313 Test: 0.4022 FPS: 2242 S BEST 
Epoch: 004  Loss: 33.424042 Train: 0.3707 Test: 0.3164 FPS: 2239 S BEST 
Epoch: 005  Loss: 29.936185 Train: 0.3252 Test: 0.2719 FPS: 2236 S BEST 
Epoch: 006  Loss: 27.523229 Train: 0.2923 Test: 0.2692 FPS: 2228 S BEST 
Epoch: 007  Loss: 25.427845 Train: 0.2666 Test: 0.2591 FPS: 2229 S BEST 
Epoch: 008  Loss: 23.742382 Train: 0.2447 Test: 0.2466 FPS: 2224 S BEST 
Epoch: 009  Loss: 22.180004 Train: 0.2272 Test: 0.2093 FPS: 2219 S BEST 
Epoch: 010  Loss: 21.187066 Train: 0.2143 Test: 0.2034 FPS: 2224 S BEST 
Epoch: 011  Loss: 20.380105 Train: 0.2027 Test: 0.1912 FPS: 2220 S BEST 
Epoch: 012  Loss: 19.001861 Train: 0.1904 Test: 0.1852 FPS: 2219 S BEST 
Epoch: 013  Loss: 18.042036 Train: 0.1808 Test: 0.1824 FPS: 2222 S BEST 
Epoch: 014  Loss: 17.610466 Train: 0.1765 Test: 0.1700 FPS: 2219 S BEST 
Epoch: 015  Loss: 16.972755 Train: 0.1674 Test: 0.1660 FPS: 2214 S BEST 
Epoch: 016  Loss: 16.179428 Train: 0.1620 Test: 0.1441 FPS: 2210 S BEST 
Epoch: 017  Loss: 15.866747 Train: 0.1564 Test: 0.1515 FPS: 2222 
Epoch: 018  Loss: 15.025643 Train: 0.1465 Test: 0.1553 FPS: 2209 
Epoch: 019  Loss: 14.809092 Train: 0.1446 Test: 0.1485 FPS: 2215 
Epoch: 020  Loss: 14.378172 Train: 0.1405 Test: 0.1757 FPS: 2217 
Epoch: 021  Loss: 14.161470 Train: 0.1361 Test: 0.1648 FPS: 2215 
Epoch: 022  Loss: 13.804728 Train: 0.1335 Test: 0.1488 FPS: 2224 
Epoch: 023  Loss: 13.475685 Train: 0.1291 Test: 0.1547 FPS: 2208 
Epoch: 024  Loss: 13.260411 Train: 0.1279 Test: 0.1410 FPS: 2214 S BEST 
Epoch: 025  Loss: 12.928991 Train: 0.1232 Test: 0.1480 FPS: 2214 
Epoch: 026  Loss: 12.723861 Train: 0.1206 Test: 0.1519 FPS: 2221 
Epoch: 027  Loss: 12.563900 Train: 0.1196 Test: 0.1480 FPS: 2217 
Epoch: 028  Loss: 12.133997 Train: 0.1134 Test: 0.1556 FPS: 2216 
Epoch: 029  Loss: 11.944532 Train: 0.1126 Test: 0.1384 FPS: 2215 S BEST 
Epoch: 030  Loss: 11.831618 Train: 0.1110 Test: 0.1279 FPS: 2216 S BEST 
Epoch: 031  Loss: 11.577101 Train: 0.1084 Test: 0.1516 FPS: 2220 
Epoch: 032  Loss: 11.526094 Train: 0.1087 Test: 0.1700 FPS: 2221 
Epoch: 033  Loss: 11.211259 Train: 0.1031 Test: 0.1291 FPS: 2216 
Epoch: 034  Loss: 11.249397 Train: 0.1037 Test: 0.1233 FPS: 2224 S BEST 
Epoch: 035  Loss: 10.923759 Train: 0.1003 Test: 0.1283 FPS: 2220 
Epoch: 036  Loss: 10.902884 Train: 0.1010 Test: 0.1207 FPS: 2223 S BEST 
Epoch: 037  Loss: 10.758886 Train: 0.0994 Test: 0.1186 FPS: 2219 S BEST 
Epoch: 038  Loss: 10.549352 Train: 0.0957 Test: 0.1374 FPS: 2218 
Epoch: 039  Loss: 10.532515 Train: 0.0970 Test: 0.1415 FPS: 2216 
Epoch: 040  Loss: 10.318624 Train: 0.0944 Test: 0.1415 FPS: 2215 
Epoch: 041  Loss: 10.247366 Train: 0.0929 Test: 0.1212 FPS: 2217 
Epoch: 042  Loss: 10.181208 Train: 0.0917 Test: 0.1179 FPS: 2217 S BEST 
Epoch: 043  Loss: 10.024730 Train: 0.0910 Test: 0.1352 FPS: 2218 
Epoch: 044  Loss: 9.925135 Train: 0.0900 Test: 0.1344 FPS: 2211 
Epoch: 045  Loss: 9.915114 Train: 0.0886 Test: 0.1164 FPS: 2214 S BEST 
Epoch: 046  Loss: 9.687315 Train: 0.0854 Test: 0.1317 FPS: 2215 
Epoch: 047  Loss: 9.743334 Train: 0.0863 Test: 0.1154 FPS: 2218 S BEST 
Epoch: 048  Loss: 9.676334 Train: 0.0866 Test: 0.1387 FPS: 2212 
Epoch: 049  Loss: 9.368113 Train: 0.0834 Test: 0.1194 FPS: 2213 
Epoch: 050  Loss: 9.440236 Train: 0.0850 Test: 0.1195 FPS: 2214 
Epoch: 051  Loss: 9.487444 Train: 0.0845 Test: 0.1144 FPS: 2214 S BEST 
Epoch: 052  Loss: 9.246920 Train: 0.0823 Test: 0.1218 FPS: 2218 
Epoch: 053  Loss: 9.124788 Train: 0.0804 Test: 0.1241 FPS: 2214 
Epoch: 054  Loss: 9.180666 Train: 0.0814 Test: 0.1099 FPS: 2217 S BEST 
Epoch: 055  Loss: 9.033421 Train: 0.0801 Test: 0.1231 FPS: 2216 
Epoch: 056  Loss: 8.989378 Train: 0.0785 Test: 0.1112 FPS: 2220 
Epoch: 057  Loss: 8.948573 Train: 0.0775 Test: 0.1249 FPS: 2213 
Epoch: 058  Loss: 8.903811 Train: 0.0790 Test: 0.1356 FPS: 2209 
Epoch: 059  Loss: 8.677252 Train: 0.0745 Test: 0.1251 FPS: 2214 
Epoch: 060  Loss: 8.930724 Train: 0.0773 Test: 0.1637 FPS: 2216 
Epoch: 061  Loss: 8.832093 Train: 0.0774 Test: 0.1282 FPS: 2216 
Epoch: 062  Loss: 8.765618 Train: 0.0758 Test: 0.1129 FPS: 2216 
Epoch: 063  Loss: 8.625199 Train: 0.0736 Test: 0.1170 FPS: 2211 
Epoch: 064  Loss: 8.549280 Train: 0.0747 Test: 0.1111 FPS: 2215 
Epoch: 065  Loss: 8.567334 Train: 0.0735 Test: 0.1109 FPS: 2222 
Epoch: 066  Loss: 8.444403 Train: 0.0727 Test: 0.1161 FPS: 2213 
Epoch: 067  Loss: 8.455833 Train: 0.0725 Test: 0.1211 FPS: 2217 
Epoch: 068  Loss: 8.368182 Train: 0.0725 Test: 0.1375 FPS: 2214 
Epoch: 069  Loss: 8.387159 Train: 0.0716 Test: 0.1539 FPS: 2217 
Epoch: 070  Loss: 8.174406 Train: 0.0709 Test: 0.1118 FPS: 2222 
Epoch: 071  Loss: 8.276706 Train: 0.0708 Test: 0.1197 FPS: 2215 
Epoch: 072  Loss: 8.441136 Train: 0.0727 Test: 0.1466 FPS: 2211 
Epoch: 073  Loss: 8.371890 Train: 0.0709 Test: 0.1230 FPS: 2216 
Epoch: 074  Loss: 8.186380 Train: 0.0703 Test: 0.1020 FPS: 2212 S BEST 
Epoch: 075  Loss: 8.270835 Train: 0.0696 Test: 0.1101 FPS: 2224 
Epoch: 076  Loss: 8.193379 Train: 0.0692 Test: 0.1403 FPS: 2220 
Epoch: 077  Loss: 8.026590 Train: 0.0665 Test: 0.1180 FPS: 2211 
Epoch: 078  Loss: 8.231564 Train: 0.0692 Test: 0.1085 FPS: 2214 
Epoch: 079  Loss: 8.201721 Train: 0.0696 Test: 0.1252 FPS: 2218 
Epoch: 080  Loss: 7.956465 Train: 0.0664 Test: 0.1141 FPS: 2213 
Epoch: 081  Loss: 7.996068 Train: 0.0676 Test: 0.1099 FPS: 2214 
Epoch: 082  Loss: 7.894192 Train: 0.0670 Test: 0.1336 FPS: 2216 
Epoch: 083  Loss: 7.874268 Train: 0.0653 Test: 0.1135 FPS: 2214 
Epoch: 084  Loss: 7.862568 Train: 0.0654 Test: 0.1169 FPS: 2217 
Epoch: 085  Loss: 8.095715 Train: 0.0686 Test: 0.1236 FPS: 2217 
Epoch: 086  Loss: 7.929582 Train: 0.0661 Test: 0.1141 FPS: 2217 
Epoch: 087  Loss: 7.782191 Train: 0.0648 Test: 0.1168 FPS: 2217 
Epoch: 088  Loss: 7.888721 Train: 0.0665 Test: 0.1008 FPS: 2211 S BEST 
Epoch: 089  Loss: 7.720711 Train: 0.0641 Test: 0.1190 FPS: 2218 
Epoch: 090  Loss: 7.690734 Train: 0.0645 Test: 0.1024 FPS: 2212 
Epoch: 091  Loss: 7.622335 Train: 0.0625 Test: 0.1376 FPS: 2210 
Epoch: 092  Loss: 7.739367 Train: 0.0655 Test: 0.1151 FPS: 2216 
Epoch: 093  Loss: 7.765516 Train: 0.0639 Test: 0.1278 FPS: 2216 
Epoch: 094  Loss: 7.758741 Train: 0.0646 Test: 0.1024 FPS: 2216 
Epoch: 095  Loss: 7.602110 Train: 0.0641 Test: 0.1143 FPS: 2217 
Epoch: 096  Loss: 7.634435 Train: 0.0638 Test: 0.1183 FPS: 2197 
Epoch: 097  Loss: 7.613938 Train: 0.0630 Test: 0.1336 FPS: 2191 
Epoch: 098  Loss: 7.606170 Train: 0.0633 Test: 0.1226 FPS: 2212 
Epoch: 099  Loss: 7.460454 Train: 0.0614 Test: 0.1063 FPS: 2204 
Epoch: 100  Loss: 7.570028 Train: 0.0628 Test: 0.0997 FPS: 2216 S BEST 
Epoch: 101  Loss: 7.425475 Train: 0.0616 Test: 0.1323 FPS: 2220 
Epoch: 102  Loss: 7.538453 Train: 0.0638 Test: 0.1300 FPS: 2229 
Epoch: 103  Loss: 7.621576 Train: 0.0627 Test: 0.1116 FPS: 2229 
Epoch: 104  Loss: 7.387600 Train: 0.0609 Test: 0.1032 FPS: 2229 
Epoch: 105  Loss: 7.396444 Train: 0.0603 Test: 0.1098 FPS: 2229 
Epoch: 106  Loss: 7.369848 Train: 0.0594 Test: 0.1105 FPS: 2227 
Epoch: 107  Loss: 7.260967 Train: 0.0591 Test: 0.1019 FPS: 2205 
Epoch: 108  Loss: 7.345426 Train: 0.0597 Test: 0.1024 FPS: 2215 
Epoch: 109  Loss: 7.267954 Train: 0.0593 Test: 0.1275 FPS: 2227 
Epoch: 110  Loss: 7.268408 Train: 0.0593 Test: 0.1192 FPS: 2231 
Epoch: 111  Loss: 7.179607 Train: 0.0579 Test: 0.1242 FPS: 2236 
Epoch: 112  Loss: 7.226192 Train: 0.0596 Test: 0.1173 FPS: 2221 
Epoch: 113  Loss: 7.168296 Train: 0.0576 Test: 0.1133 FPS: 2224 
Epoch: 114  Loss: 7.200943 Train: 0.0577 Test: 0.1141 FPS: 2226 
Epoch: 115  Loss: 7.285295 Train: 0.0592 Test: 0.1064 FPS: 2223 
Epoch: 116  Loss: 7.167954 Train: 0.0579 Test: 0.1073 FPS: 2227 
Epoch: 117  Loss: 7.078483 Train: 0.0577 Test: 0.1017 FPS: 2224 
Epoch: 118  Loss: 7.094661 Train: 0.0557 Test: 0.1035 FPS: 2227 
Epoch: 119  Loss: 7.084054 Train: 0.0576 Test: 0.1057 FPS: 2227 
Epoch: 120  Loss: 7.201355 Train: 0.0569 Test: 0.0991 FPS: 2228 S BEST 
Epoch: 121  Loss: 7.149871 Train: 0.0589 Test: 0.1139 FPS: 2229 
Epoch: 122  Loss: 7.093234 Train: 0.0563 Test: 0.1096 FPS: 2227 
Epoch: 123  Loss: 7.185316 Train: 0.0585 Test: 0.1090 FPS: 2230 
Epoch: 124  Loss: 6.962293 Train: 0.0555 Test: 0.1088 FPS: 2227 
Epoch: 125  Loss: 7.004013 Train: 0.0548 Test: 0.1240 FPS: 2230 
Epoch: 126  Loss: 7.040227 Train: 0.0572 Test: 0.1194 FPS: 2229 
Epoch: 127  Loss: 7.104682 Train: 0.0570 Test: 0.1077 FPS: 2225 
Epoch: 128  Loss: 6.946112 Train: 0.0554 Test: 0.1119 FPS: 2228 
Epoch: 129  Loss: 6.939913 Train: 0.0551 Test: 0.1208 FPS: 2232 
Epoch: 130  Loss: 7.016218 Train: 0.0556 Test: 0.1027 FPS: 2231 
Epoch: 131  Loss: 7.026231 Train: 0.0565 Test: 0.1160 FPS: 2227 
Epoch: 132  Loss: 6.912979 Train: 0.0543 Test: 0.1141 FPS: 2228 
Epoch: 133  Loss: 7.004997 Train: 0.0564 Test: 0.1129 FPS: 2230 
Epoch: 134  Loss: 6.902556 Train: 0.0538 Test: 0.1195 FPS: 2228 
Epoch: 135  Loss: 7.023252 Train: 0.0570 Test: 0.1081 FPS: 2228 
Epoch: 136  Loss: 6.997831 Train: 0.0569 Test: 0.1140 FPS: 2228 
Epoch: 137  Loss: 6.883520 Train: 0.0562 Test: 0.1089 FPS: 2227 
Epoch: 138  Loss: 6.954636 Train: 0.0560 Test: 0.1110 FPS: 2222 
Epoch: 139  Loss: 6.997488 Train: 0.0558 Test: 0.1096 FPS: 2230 
Epoch: 140  Loss: 6.865381 Train: 0.0543 Test: 0.1220 FPS: 2224 
Epoch: 141  Loss: 6.851749 Train: 0.0539 Test: 0.1419 FPS: 2229 
Epoch: 142  Loss: 6.945951 Train: 0.0551 Test: 0.1222 FPS: 2226 
Epoch: 143  Loss: 6.877952 Train: 0.0549 Test: 0.1018 FPS: 2226 
Epoch: 144  Loss: 6.956868 Train: 0.0545 Test: 0.1123 FPS: 2228 
Epoch: 145  Loss: 6.797688 Train: 0.0531 Test: 0.1207 FPS: 2227 
Epoch: 146  Loss: 6.736027 Train: 0.0515 Test: 0.1113 FPS: 2224 
Epoch: 147  Loss: 6.785656 Train: 0.0530 Test: 0.1071 FPS: 2226 
Epoch: 148  Loss: 6.889249 Train: 0.0538 Test: 0.1139 FPS: 2224 
Epoch: 149  Loss: 6.765541 Train: 0.0536 Test: 0.1036 FPS: 2229 
Epoch: 150  Loss: 6.756967 Train: 0.0542 Test: 0.1036 FPS: 2229 
Epoch: 151  Loss: 6.843782 Train: 0.0533 Test: 0.1093 FPS: 2228 
Epoch: 152  Loss: 6.797542 Train: 0.0533 Test: 0.1141 FPS: 2227 
Epoch: 153  Loss: 6.631298 Train: 0.0517 Test: 0.1244 FPS: 2228 
Epoch: 154  Loss: 6.673993 Train: 0.0522 Test: 0.1052 FPS: 2228 
Epoch: 155  Loss: 6.668332 Train: 0.0526 Test: 0.1076 FPS: 2226 
Epoch: 156  Loss: 6.686079 Train: 0.0521 Test: 0.1046 FPS: 2228 
Epoch: 157  Loss: 6.790319 Train: 0.0527 Test: 0.1169 FPS: 2228 
Epoch: 158  Loss: 6.674809 Train: 0.0518 Test: 0.1043 FPS: 2228 
Epoch: 159  Loss: 6.724141 Train: 0.0526 Test: 0.1070 FPS: 2226 
Epoch: 160  Loss: 6.563121 Train: 0.0517 Test: 0.1140 FPS: 2233 
Epoch: 161  Loss: 6.623751 Train: 0.0519 Test: 0.1006 FPS: 2227 
Epoch: 162  Loss: 6.725552 Train: 0.0531 Test: 0.1064 FPS: 2231 
Epoch: 163  Loss: 6.520165 Train: 0.0505 Test: 0.1276 FPS: 2231 
Epoch: 164  Loss: 6.692438 Train: 0.0532 Test: 0.0984 FPS: 2231 S BEST 
