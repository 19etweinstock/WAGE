2021-09-14 21:33:44 

import time
import tensorflow as tf

tf.compat.v1.disable_eager_execution()
tf.compat.v1.disable_v2_behavior()

bitsW = 1  # bit width of weights
bitsA = 1  # bit width of activations
bitsG = 12  # bit width of gradients
bitsE = 12 # bit width of errors

Epoch = 10

lr_schedule = [0,1]

bitsR = 16  # bit width of randomizer

Time = time.strftime('%Y-%m-%d', time.localtime())
Notes = f'lenet5 {bitsW}{bitsA}{hex(bitsG)}{hex(bitsE)} {bitsR} {lr_schedule} {Epoch}'
# Notes = 'lenet5 2888'
# Notes = 'alexnet 28CC'

GPU = [0]
batchSize = 128
validNum = 0

dataSet = 'MNIST'  # 'MNIST','SVHN','CIFAR10', 'ILSVRC2012'

loadModel = None
# loadModel = '../model/' + '2017-10-26' + '(' + 'vgg7 2888' + ')' + '.tf'
# saveModel = None
saveModel = '../model/' + Time + '(' + Notes + ')' + '.tf'


use_batch_norm = False
lr = tf.compat.v1.Variable(initial_value=0., trainable=False, name='lr', dtype=tf.float32)
# lr_schedule = [0, 8, 200, 1,250,1./8,300,0]
# lr_schedule = [0, 32, 40, 32./8, 60, 32./64, 80, 0]
L2 = 0

lossFunc = 'SSE'
# lossFunc = tf.losses.softmax_cross_entropy
optimizer = tf.compat.v1.train.GradientDescentOptimizer(1)  # lr is controlled in Quantize.G

# shared variables, defined by other files
seed = None
sess = None
W_scale = []

W: /device:GPU:0 Conv/conv0/ [5, 5, 1, 32] Scale:4
W: /device:GPU:0 Conv/conv1/ [5, 5, 32, 64] Scale:32
W: /device:GPU:0 Fc/fc0/ [1024, 512] Scale:32
W: /device:GPU:0 Fc/fc1/ [512, 10] Scale:16
CONV: 52000 FC: 529408 Total: 581408
W: /device:GPU:0 Conv_1/conv0/ [5, 5, 1, 32] Scale:4
W: /device:GPU:0 Conv_1/conv1/ [5, 5, 32, 64] Scale:32
W: /device:GPU:0 Fc_1/fc0/ [1024, 512] Scale:32
W: /device:GPU:0 Fc_1/fc1/ [512, 10] Scale:16

Optimization Start!

lr: 0.000000 -> 1.000000
Epoch: 000  Loss: 689.589744 Train: 0.5558 Test: 0.5529 FPS: 2006 
Epoch: 001  Loss: 688.357906 Train: 0.5522 Test: 0.5529 FPS: 3471 
Epoch: 002  Loss: 687.831197 Train: 0.5496 Test: 0.5529 FPS: 3837 
Epoch: 003  Loss: 687.196581 Train: 0.5462 Test: 0.5303 FPS: 3789 S BEST 
Epoch: 004  Loss: 673.395299 Train: 0.5100 Test: 0.5425 FPS: 4124 
Epoch: 005  Loss: 670.298077 Train: 0.5323 Test: 0.5334 FPS: 4335 
Epoch: 006  Loss: 659.450855 Train: 0.5010 Test: 0.4794 FPS: 4171 S BEST 
Epoch: 007  Loss: 650.057692 Train: 0.4709 Test: 0.4683 FPS: 3626 S BEST 
Epoch: 008  Loss: 648.376068 Train: 0.4639 Test: 0.4721 FPS: 4096 
Epoch: 009  Loss: 649.054487 Train: 0.4695 Test: 0.4813 FPS: 4184 
