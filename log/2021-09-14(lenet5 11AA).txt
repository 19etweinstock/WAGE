2021-09-14 18:58:07 

import time
import tensorflow as tf

tf.compat.v1.disable_eager_execution()
tf.compat.v1.disable_v2_behavior()

Time = time.strftime('%Y-%m-%d', time.localtime())
Notes = 'lenet5 11AA'
# Notes = 'lenet5 2888'
# Notes = 'alexnet 28CC'

GPU = [0]
batchSize = 128
validNum = 0

dataSet = 'MNIST'  # 'MNIST','SVHN','CIFAR10', 'ILSVRC2012'

loadModel = None
# loadModel = '../model/' + '2017-10-26' + '(' + 'vgg7 2888' + ')' + '.tf'
# saveModel = None
saveModel = '../model/' + Time + '(' + Notes + ')' + '.tf'

bitsW = 1  # bit width of weights
bitsA = 1  # bit width of activations
bitsG = 10  # bit width of gradients
bitsE = 10 # bit width of errors

bitsR = 16  # bit width of randomizer

use_batch_norm = False
lr = tf.compat.v1.Variable(initial_value=0., trainable=False, name='lr', dtype=tf.float32)
lr_schedule = [0,1]
# lr_schedule = [0, 8, 200, 1,250,1./8,300,0]
# lr_schedule = [0, 32, 40, 32./8, 60, 32./64, 80, 0]
L2 = 0

lossFunc = 'SSE'
# lossFunc = tf.losses.softmax_cross_entropy
optimizer = tf.compat.v1.train.GradientDescentOptimizer(1)  # lr is controlled in Quantize.G

# shared variables, defined by other files
seed = None
sess = None
W_scale = []

W: /device:GPU:0 Conv/conv0/ [5, 5, 1, 32] Scale:4
W: /device:GPU:0 Conv/conv1/ [5, 5, 32, 64] Scale:32
W: /device:GPU:0 Fc/fc0/ [1024, 512] Scale:32
W: /device:GPU:0 Fc/fc1/ [512, 10] Scale:16
CONV: 52000 FC: 529408 Total: 581408
W: /device:GPU:0 Conv_1/conv0/ [5, 5, 1, 32] Scale:4
W: /device:GPU:0 Conv_1/conv1/ [5, 5, 32, 64] Scale:32
W: /device:GPU:0 Fc_1/fc0/ [1024, 512] Scale:32
W: /device:GPU:0 Fc_1/fc1/ [512, 10] Scale:16

Optimization Start!

lr: 0.000000 -> 1.000000
Epoch: 000  Loss: 742.704060 Train: 0.6765 Test: 0.6649 FPS: 4989 
Epoch: 001  Loss: 700.873932 Train: 0.5594 Test: 0.4633 FPS: 11803 S BEST 
Epoch: 002  Loss: 638.316239 Train: 0.3713 Test: 0.4188 FPS: 11631 S BEST 
Epoch: 003  Loss: 644.567308 Train: 0.4409 Test: 0.4587 FPS: 11591 
Epoch: 004  Loss: 647.694444 Train: 0.4616 Test: 0.4326 FPS: 11600 
Epoch: 005  Loss: 638.253205 Train: 0.4238 Test: 0.3974 FPS: 11588 S BEST 
Epoch: 006  Loss: 626.571581 Train: 0.3867 Test: 0.3787 FPS: 11217 S BEST 
Epoch: 007  Loss: 620.027778 Train: 0.3967 Test: 0.4147 FPS: 11399 
Epoch: 008  Loss: 604.849359 Train: 0.3918 Test: 0.4046 FPS: 11579 
Epoch: 009  Loss: 604.991453 Train: 0.4331 Test: 0.4457 FPS: 11573 
Epoch: 010  Loss: 591.956197 Train: 0.4563 Test: 0.5444 FPS: 11552 
Epoch: 011  Loss: 580.165598 Train: 0.4285 Test: 0.4350 FPS: 11519 
Epoch: 012  Loss: 606.153846 Train: 0.4319 Test: 0.3949 FPS: 11506 
Epoch: 013  Loss: 580.655983 Train: 0.4109 Test: 0.2950 FPS: 11495 S BEST 
Epoch: 014  Loss: 348.028846 Train: 0.5275 Test: 0.5924 FPS: 11249 
Epoch: 015  Loss: 274.996795 Train: 0.6108 Test: 0.6431 FPS: 11352 
Epoch: 016  Loss: 239.900641 Train: 0.6724 Test: 0.8475 FPS: 11523 
Epoch: 017  Loss: 230.194444 Train: 0.5736 Test: 0.8844 FPS: 11305 
Epoch: 018  Loss: 214.177350 Train: 0.5278 Test: 0.3728 FPS: 10982 
Epoch: 019  Loss: 256.352564 Train: 0.5658 Test: 0.8599 FPS: 11132 
Epoch: 020  Loss: 192.601496 Train: 0.5106 Test: 0.7741 FPS: 11167 
Epoch: 021  Loss: 203.863248 Train: 0.6620 Test: 0.8751 FPS: 11349 
Epoch: 022  Loss: 460.172009 Train: 0.5328 Test: 0.2064 FPS: 11305 S BEST 
Epoch: 023  Loss: nan Train: 0.2573 Test: 1.0000 FPS: 11240 
Epoch: 024  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 11290 
Epoch: 025  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 11233 
Epoch: 026  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 11423 
Epoch: 027  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 11209 
Epoch: 028  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 11340 
Epoch: 029  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 11168 
Epoch: 030  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 10968 
Epoch: 031  Loss: nan Train: 1.0000 Test: 1.0000 FPS: 11185 
Epoch: 032  