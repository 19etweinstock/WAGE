2021-09-17 11:40:08 

import time
import tensorflow as tf

tf.compat.v1.disable_eager_execution()
tf.compat.v1.disable_v2_behavior()

bitsW = 1  # bit width of weights
bitsA = 8  # bit width of activations
bitsG = 8  # bit width of gradients
bitsE = 8 # bit width of errors

bitsR = 16  # bit width of randomizer

lr_schedule = [0,1]

Epoch = 100

batchSize = 128

dataSet = 'MNIST'  # 'MNIST','SVHN','CIFAR10', 'ILSVRC2012'

def upper(str):
    return str.upper()

Time = time.strftime('%Y-%m-%d', time.localtime())
Notes = f'{dataSet} {bitsW}{bitsA}{upper(hex(bitsG)[2:])}{upper(hex(bitsE)[2:])} {bitsR} {lr_schedule} {Epoch} {batchSize}'
# Notes = 'lenet5 2888'
# Notes = 'alexnet 28CC'

GPU = [0]
validNum = 0


loadModel = None
# loadModel = '../model/' + '2017-10-26' + '(' + 'vgg7 2888' + ')' + '.tf'
# saveModel = None
saveModel = '../model/' + Time + '(' + Notes + ')' + '.tf'


use_batch_norm = False
lr = tf.compat.v1.Variable(initial_value=0., trainable=False, name='lr', dtype=tf.float32)
# lr_schedule = [0, 8, 200, 1,250,1./8,300,0]
# lr_schedule = [0, 32, 40, 32./8, 60, 32./64, 80, 0]
L2 = 0

lossFunc = 'SSE'
# lossFunc = tf.losses.softmax_cross_entropy
optimizer = tf.compat.v1.train.GradientDescentOptimizer(1)  # lr is controlled in Quantize.G

# shared variables, defined by other files
seed = None
sess = None
W_scale = []

def upper(str):
    return str.upper()

W: /device:GPU:0 Conv/conv0/ [5, 5, 1, 32] Scale:4
W: /device:GPU:0 Conv/conv1/ [5, 5, 32, 64] Scale:32
W: /device:GPU:0 Fc/fc0/ [1024, 512] Scale:32
W: /device:GPU:0 Fc/fc1/ [512, 10] Scale:16
CONV: 52000 FC: 529408 Total: 581408
W: /device:GPU:0 Conv_1/conv0/ [5, 5, 1, 32] Scale:4
W: /device:GPU:0 Conv_1/conv1/ [5, 5, 32, 64] Scale:32
W: /device:GPU:0 Fc_1/fc0/ [1024, 512] Scale:32
W: /device:GPU:0 Fc_1/fc1/ [512, 10] Scale:16

Optimization Start!

lr: 0.000000 -> 1.000000
Epoch: 000  Loss: 100.546383 Train: 0.7557 Test: 0.4091 FPS: 7175 
Epoch: 001  Loss: 34.198932 Train: 0.2351 Test: 0.1268 FPS: 11177 S BEST 
Epoch: 002  Loss: 24.330379 Train: 0.1133 Test: 0.0834 FPS: 10448 S BEST 
Epoch: 003  Loss: 19.857131 Train: 0.0834 Test: 0.0676 FPS: 10606 S BEST 
Epoch: 004  Loss: 17.428595 Train: 0.0713 Test: 0.0573 FPS: 10480 S BEST 
Epoch: 005  Loss: 15.372962 Train: 0.0584 Test: 0.0526 FPS: 10581 S BEST 
Epoch: 006  Loss: 13.943127 Train: 0.0532 Test: 0.0502 FPS: 10595 S BEST 
Epoch: 007  Loss: 12.898544 Train: 0.0496 Test: 0.0416 FPS: 10520 S BEST 
Epoch: 008  Loss: 11.854313 Train: 0.0446 Test: 0.0381 FPS: 10508 S BEST 
Epoch: 009  Loss: 11.088846 Train: 0.0401 Test: 0.0362 FPS: 10520 S BEST 
Epoch: 010  Loss: 10.445703 Train: 0.0375 Test: 0.0346 FPS: 10561 S BEST 
Epoch: 011  Loss: 9.995645 Train: 0.0371 Test: 0.0344 FPS: 10526 S BEST 
Epoch: 012  Loss: 9.374940 Train: 0.0336 Test: 0.0309 FPS: 11109 S BEST 
Epoch: 013  Loss: 8.922906 Train: 0.0322 Test: 0.0308 FPS: 10188 S BEST 
Epoch: 014  Loss: 8.304142 Train: 0.0299 Test: 0.0268 FPS: 9645 S BEST 
Epoch: 015  Loss: 8.027865 Train: 0.0284 Test: 0.0272 FPS: 9842 
Epoch: 016  Loss: 7.729661 Train: 0.0278 Test: 0.0257 FPS: 10373 S BEST 
Epoch: 017  Loss: 7.395087 Train: 0.0260 Test: 0.0246 FPS: 10483 S BEST 
Epoch: 018  Loss: 7.214723 Train: 0.0274 Test: 0.0216 FPS: 9936 S BEST 
Epoch: 019  Loss: 6.867900 Train: 0.0245 Test: 0.0214 FPS: 10445 S BEST 
Epoch: 020  Loss: 6.659837 Train: 0.0231 Test: 0.0210 FPS: 10190 S BEST 
Epoch: 021  Loss: 6.466578 Train: 0.0230 Test: 0.0215 FPS: 10412 
Epoch: 022  Loss: 6.301278 Train: 0.0227 Test: 0.0201 FPS: 10438 S BEST 
Epoch: 023  Loss: 6.031092 Train: 0.0217 Test: 0.0196 FPS: 10434 S BEST 
Epoch: 024  Loss: 5.798206 Train: 0.0206 Test: 0.0209 FPS: 10492 
Epoch: 025  Loss: 5.801986 Train: 0.0218 Test: 0.0185 FPS: 11053 S BEST 
Epoch: 026  Loss: 5.526680 Train: 0.0190 Test: 0.0187 FPS: 10754 
Epoch: 027  Loss: 5.438860 Train: 0.0196 Test: 0.0175 FPS: 10920 S BEST 
Epoch: 028  Loss: 5.257483 Train: 0.0187 Test: 0.0174 FPS: 10712 S BEST 
Epoch: 029  Loss: 5.245993 Train: 0.0185 Test: 0.0160 FPS: 10672 S BEST 
Epoch: 030  Loss: 5.057021 Train: 0.0174 Test: 0.0173 FPS: 10034 
Epoch: 031  Loss: 4.994265 Train: 0.0174 Test: 0.0155 FPS: 10797 S BEST 
Epoch: 032  Loss: 4.876710 Train: 0.0169 Test: 0.0153 FPS: 10916 S BEST 
Epoch: 033  Loss: 4.844351 Train: 0.0168 Test: 0.0149 FPS: 10841 S BEST 
Epoch: 034  Loss: 4.710883 Train: 0.0161 Test: 0.0170 FPS: 10703 
Epoch: 035  Loss: 4.657945 Train: 0.0163 Test: 0.0141 FPS: 10891 S BEST 
Epoch: 036  Loss: 4.575673 Train: 0.0155 Test: 0.0131 FPS: 10789 S BEST 
Epoch: 037  Loss: 4.450400 Train: 0.0154 Test: 0.0129 FPS: 10693 S BEST 
Epoch: 038  Loss: 4.457154 Train: 0.0158 Test: 0.0131 FPS: 10633 
Epoch: 039  Loss: 4.337223 Train: 0.0149 Test: 0.0135 FPS: 11077 
Epoch: 040  Loss: 4.246808 Train: 0.0145 Test: 0.0147 FPS: 11183 
Epoch: 041  Loss: 4.254800 Train: 0.0156 Test: 0.0128 FPS: 11133 S BEST 
Epoch: 042  Loss: 4.022762 Train: 0.0136 Test: 0.0137 FPS: 10862 
Epoch: 043  Loss: 4.098575 Train: 0.0149 Test: 0.0125 FPS: 10799 S BEST 
Epoch: 044  Loss: 4.072394 Train: 0.0142 Test: 0.0122 FPS: 10666 S BEST 
Epoch: 045  Loss: 3.986314 Train: 0.0136 Test: 0.0125 FPS: 9916 
Epoch: 046  Loss: 3.935629 Train: 0.0136 Test: 0.0150 FPS: 10111 
Epoch: 047  Loss: 3.905676 Train: 0.0140 Test: 0.0120 FPS: 10422 S BEST 
Epoch: 048  Loss: 3.853402 Train: 0.0132 Test: 0.0122 FPS: 11028 
Epoch: 049  Loss: 3.834024 Train: 0.0132 Test: 0.0128 FPS: 10941 
Epoch: 050  Loss: 3.800117 Train: 0.0124 Test: 0.0131 FPS: 10458 
Epoch: 051  Loss: 3.803336 Train: 0.0131 Test: 0.0113 FPS: 10712 S BEST 
Epoch: 052  Loss: 3.665464 Train: 0.0128 Test: 0.0111 FPS: 10916 S BEST 
Epoch: 053  Loss: 3.644585 Train: 0.0130 Test: 0.0119 FPS: 10690 
Epoch: 054  Loss: 3.531858 Train: 0.0123 Test: 0.0105 FPS: 11006 S BEST 
Epoch: 055  Loss: 3.598858 Train: 0.0124 Test: 0.0116 FPS: 10773 
Epoch: 056  Loss: 3.524348 Train: 0.0121 Test: 0.0120 FPS: 10791 
Epoch: 057  Loss: 3.467876 Train: 0.0126 Test: 0.0097 FPS: 10647 S BEST 
Epoch: 058  Loss: 3.500778 Train: 0.0125 Test: 0.0117 FPS: 10360 
Epoch: 059  Loss: 3.421528 Train: 0.0126 Test: 0.0124 FPS: 10919 
Epoch: 060  Loss: 3.453242 Train: 0.0114 Test: 0.0107 FPS: 10688 
Epoch: 061  Loss: 3.434724 Train: 0.0125 Test: 0.0114 FPS: 10672 
Epoch: 062  Loss: 3.396469 Train: 0.0115 Test: 0.0115 FPS: 10454 
Epoch: 063  Loss: 3.323425 Train: 0.0108 Test: 0.0114 FPS: 10847 
Epoch: 064  Loss: 3.325683 Train: 0.0116 Test: 0.0116 FPS: 10843 
Epoch: 065  Loss: 3.235302 Train: 0.0105 Test: 0.0111 FPS: 10873 
Epoch: 066  Loss: 3.245687 Train: 0.0103 Test: 0.0102 FPS: 10835 
Epoch: 067  Loss: 3.238782 Train: 0.0112 Test: 0.0098 FPS: 10756 
Epoch: 068  Loss: 3.207226 Train: 0.0111 Test: 0.0112 FPS: 10536 
Epoch: 069  Loss: 3.158161 Train: 0.0103 Test: 0.0108 FPS: 10312 
Epoch: 070  Loss: 3.188649 Train: 0.0104 Test: 0.0097 FPS: 10632 S BEST 
Epoch: 071  Loss: 3.179852 Train: 0.0113 Test: 0.0099 FPS: 10965 
Epoch: 072  Loss: 3.152523 Train: 0.0106 Test: 0.0100 FPS: 10784 
Epoch: 073  Loss: 3.118677 Train: 0.0101 Test: 0.0094 FPS: 10733 S BEST 
Epoch: 074  Loss: 3.110488 Train: 0.0109 Test: 0.0101 FPS: 10037 
Epoch: 075  Loss: 3.015383 Train: 0.0097 Test: 0.0102 FPS: 10665 
Epoch: 076  Loss: 3.071706 Train: 0.0103 Test: 0.0093 FPS: 11142 S BEST 
Epoch: 077  Loss: 3.054822 Train: 0.0104 Test: 0.0093 FPS: 10797 
Epoch: 078  Loss: 3.000644 Train: 0.0094 Test: 0.0093 FPS: 11071 
Epoch: 079  Loss: 3.033847 Train: 0.0106 Test: 0.0091 FPS: 10982 S BEST 
Epoch: 080  Loss: 2.967233 Train: 0.0097 Test: 0.0090 FPS: 10743 S BEST 
Epoch: 081  Loss: 2.999971 Train: 0.0096 Test: 0.0089 FPS: 11035 S BEST 
Epoch: 082  Loss: 2.941040 Train: 0.0099 Test: 0.0092 FPS: 10968 
Epoch: 083  Loss: 2.965025 Train: 0.0089 Test: 0.0091 FPS: 11104 
Epoch: 084  Loss: 2.924964 Train: 0.0086 Test: 0.0090 FPS: 10906 
Epoch: 085  Loss: 2.906633 Train: 0.0095 Test: 0.0088 FPS: 11046 S BEST 
Epoch: 086  Loss: 2.883510 Train: 0.0096 Test: 0.0093 FPS: 10652 
Epoch: 087  Loss: 2.904292 Train: 0.0097 Test: 0.0095 FPS: 10917 
Epoch: 088  Loss: 2.803432 Train: 0.0088 Test: 0.0101 FPS: 11040 
Epoch: 089  Loss: 2.838288 Train: 0.0093 Test: 0.0093 FPS: 10650 
Epoch: 090  Loss: 2.831360 Train: 0.0091 Test: 0.0087 FPS: 10710 S BEST 
Epoch: 091  Loss: 2.740752 Train: 0.0091 Test: 0.0087 FPS: 10460 
Epoch: 092  Loss: 2.800706 Train: 0.0090 Test: 0.0085 FPS: 10544 S BEST 
Epoch: 093  Loss: 2.778682 Train: 0.0087 Test: 0.0084 FPS: 10957 S BEST 
Epoch: 094  Loss: 2.727172 Train: 0.0086 Test: 0.0084 FPS: 10557 S BEST 
Epoch: 095  Loss: 2.765647 Train: 0.0088 Test: 0.0094 FPS: 10667 
Epoch: 096  Loss: 2.743127 Train: 0.0088 Test: 0.0094 FPS: 10839 
Epoch: 097  Loss: 2.739965 Train: 0.0087 Test: 0.0087 FPS: 10892 
Epoch: 098  Loss: 2.742040 Train: 0.0091 Test: 0.0084 FPS: 10905 
Epoch: 099  Loss: 2.683284 Train: 0.0085 Test: 0.0086 FPS: 10782 
